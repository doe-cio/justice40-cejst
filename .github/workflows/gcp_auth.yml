name: Test GCP Auth and Upload Actions" 
on:
  workflow_dispatch:
    branches:
      - gcp_workflows
    paths:
      - "client/**/*"
env:
  WORKING_DIRECTORY: ./client
jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: client
    strategy:
      matrix:
        node-version: [14.x]

    # Add "id-token" with the intended permissions.
    permissions:
      contents: 'read'
      id-token: 'write'

    steps:
      - uses: actions/checkout@v3

      - id: 'auth'
        uses: 'google-github-actions/auth@v1'
        with:
          workload_identity_provider: 'projects/1059665175923/locations/global/workloadIdentityPools/j40-pool/providers/j40-provider'
          service_account: 'j40-service-account@prj-icc-sandbox-poc.iam.gserviceaccount.com'

      - id: 'upload-folder'
        uses: 'google-github-actions/upload-cloud-storage@v1'
        with:
          path: ./public
          destination: 'doe-justice40-website/justice40-cejst'
